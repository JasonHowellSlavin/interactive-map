# Express MySQL Boilerplate

A simple Express.js server with MySQL database and Lit web components, avoiding build tools and bundlers.

## Features

- Express.js server written in TypeScript
- MySQL database with local file persistence
- Lit web component (loaded via CDN, no bundling)
- Single HTML page served statically
- Docker support with docker-compose
- TypeScript compiler (tsc) - no bundler required

## Prerequisites

- Node.js (v18 or higher recommended for ES modules)
- MySQL server installed and running

### Installing MySQL on macOS

```bash
# Using Homebrew
brew install mysql
brew services start mysql

# Set root password (optional, defaults to empty)
mysql_secure_installation
```

## Setup

1. Install dependencies:
```bash
npm install
```

2. Compile TypeScript:
```bash
npm run build
```

This compiles TypeScript files to JavaScript in the `dist/` directory.

3. Set MySQL password (if you have one set):
```bash
export MYSQL_PASSWORD=your_password
```

4. Setup the database:
```bash
npm run setup-db
```

This will:
- Create the `boilerplate_db` database
- Create a sample `messages` table
- Insert sample data

## Running the Server

### Option 1: Using Docker (Recommended)

The easiest way to run the project is using Docker Compose, which sets up both MySQL and the Node.js server:

```bash
# Build and start all services
docker-compose up --build

# Or run in detached mode
docker-compose up -d --build
```

The server will be available at `http://localhost:3000`

To stop the services:
```bash
docker-compose down
```

To stop and remove volumes (clears database data):
```bash
docker-compose down -v
```

### Option 2: Local Development

1. Make sure MySQL is running locally
2. Compile TypeScript (if not already done):
```bash
npm run build
```
3. Set MySQL password (if you have one set):
```bash
export MYSQL_PASSWORD=your_password
```
4. Setup the database:
```bash
npm run setup-db
```
5. Start the server:
```bash
npm start
```

The server will start on `http://localhost:3000`

**Note**: After making changes to TypeScript files, run `npm run build` again to recompile.

## Project Structure

```
.
├── server.ts          # Express server (TypeScript source)
├── setup-db.ts        # Database setup script (TypeScript source)
├── tsconfig.json      # TypeScript configuration
├── package.json       # Dependencies and scripts
├── Dockerfile         # Dockerfile that sets up Node.js 20 and npm
├── docker-compose.yml # Docker Compose configuration
├── .dockerignore      # Files to exclude from Docker build
├── dist/              # Compiled JavaScript (generated by tsc)
├── docker/
│   └── mysql-init.sql # MySQL initialization script
├── public/
│   └── index.html     # Main HTML page with Lit component
└── README.md
```

## Database Persistence

### Docker
When using Docker Compose, MySQL data is persisted in a Docker volume named `mysql_data`. This volume persists even when containers are stopped, ensuring your data remains intact.

To view volumes:
```bash
docker volume ls
```

To inspect the MySQL volume:
```bash
docker volume inspect boilerplate_mysql_data
```

### Local MySQL
MySQL stores data in its data directory:
- **macOS (Homebrew)**: `/usr/local/var/mysql/`
- **Linux**: `/var/lib/mysql/`
- **Windows**: `C:\ProgramData\MySQL\MySQL Server X.X\Data\`

The database files are automatically persisted to disk by MySQL.

## API Endpoints

- `GET /` - Serves the main HTML page
- `GET /api/test` - Tests database connection

## Docker Configuration

The Docker setup is designed for fresh installations on web servers and includes:

### Node.js Application Container
- **Base Image**: `node:20-alpine` (includes Node.js 20 and npm)
- **Dockerfile**: Builds a complete Node.js environment with all dependencies
- **TypeScript Compilation**: Automatically compiles TypeScript to JavaScript during build
- **Verification**: Dockerfile verifies Node.js and npm versions during build
- **No Local Node.js Required**: The Docker image contains everything needed - no need to install Node.js on the host server

### MySQL Database Container
- **MySQL 8.0** container with persistent data volume
- Automatic database initialization (database and tables created on first run)
- Automatic health checks to ensure MySQL is ready before starting the app
- Network configuration for service communication

### Key Features
- **Self-contained**: No need to install Node.js, npm, or MySQL on the host server
- **Fresh Install Ready**: Works on any server with Docker and Docker Compose installed
- The MySQL container automatically runs the initialization script (`docker/mysql-init.sql`) on first startup, creating the database and tables without needing to run `setup-db.js` manually

### Environment Variables

Docker Compose uses these environment variables:
- `MYSQL_ROOT_PASSWORD`: MySQL root password (default: `rootpassword`)
- `MYSQL_HOST`: MySQL hostname (default: `mysql` - the service name)
- `MYSQL_PASSWORD`: MySQL password (default: `rootpassword`)
- `PORT`: Server port (default: `3000`)

You can override these by modifying `docker-compose.yml` or using a `.env` file.

## TypeScript

This project uses TypeScript for type safety and better developer experience. The TypeScript compiler (`tsc`) is used to compile TypeScript to JavaScript - this is **not a bundler**, just a compiler that transforms TypeScript code to JavaScript.

- **Source files**: `.ts` files in the root directory
- **Compiled output**: JavaScript files in the `dist/` directory
- **Configuration**: `tsconfig.json` defines compilation settings
- **No bundling**: Each file compiles to a corresponding JavaScript file, maintaining ES modules

## Notes

- TypeScript compiler (tsc) is used - not a bundler, just a compiler
- Lit is loaded via CDN using ES modules and import maps (no bundling)
- MySQL connection uses connection pooling for efficiency
- Database credentials can be set via environment variables
- Docker setup handles MySQL initialization automatically
- Docker build automatically compiles TypeScript before starting the server

